#!/bin/bash



# Job Specifications
#-----------------------------------------------------
#
#BSUB -L /bin/bash
#BSUB -J GeS2_6L-AB
#BSUB -n 40                      # number of cores to allocate for the job
#BSUB -R "span[ptile=4]"
#BSUB -R "rusage[mem=2500]"
#BSUB -W  4:00                  # sets job's runtime wall-clock limit
#BSUB -u xiuyu@tamu.edu        # Your username
#BSUB -P 082753775485           # class account

module purge
module load intel/2017A
#module load ictce/7.1.2
WORKDIR=`pwd`

#-------------------job set up-----------------------------#
cd ${WORKDIR}
log=${WORKDIR}/job.txt
echo "job start: "`date` > ${log}
echo "work directory: "$WORKDIR >> $log
topdir=`pwd`

#-------------------user define-----------------------------#
EXEC=/home/xiuyu/bin/vasp.5.4.4
cp ~/bin/vdw_kernel.bindat .

cp input/POSCAR .
cp input/POTCAR .
cp input/INCAR .
cp input/KPOINTS .


for i in 0.15 0.16 0.18 0.20; do
a0=3.9040301766025620
b0=4.4853298617698485
c0=55.6408871599999983
D=`echo $i+1.000 | bc`
a=`echo $a0*$D | bc -l`
b=`echo $b0*$D | bc -l`
cat > POSCAR <<!
GeSe-6L
    1.00000000000000
     $a    0.0000000000000000    0.0000000000000000
     0.0000000000000000    $b    0.0000000000000000
     0.0000000000000000    0.0000000000000000    $c0
   Ge   Se
   12     12
Direct
  0.2500000000000000  0.1111218245877724  0.2255400623929479
  0.2500000000000000  0.1206730335645294  0.4250299978028008
  0.2500000000000000  0.1179519938205658  0.6251032820552764
  0.7500000000000000  0.8820480261794356  0.3748966979447220
  0.7500000000000000  0.8793269864354722  0.5749700021971993
  0.7500000000000000  0.8888781954122293  0.7744599276070516
  0.7500000000000000  0.6141691792613634  0.2727918682608907
  0.7500000000000000  0.6207772166286027  0.4748997064809969
  0.7500000000000000  0.6174649335350864  0.6746508080797144
  0.2500000000000000  0.3825350464649121  0.3253492019202861
  0.2500000000000000  0.3792227633713955  0.5251003135189987
  0.2500000000000000  0.3858308007386350  0.7272081317391090
  0.2500000000000000  0.4968198337786112  0.3708683947034792
  0.2500000000000000  0.4950592343498962  0.5707523837996247
  0.2500000000000000  0.4975020363912035  0.7727486218365707
  0.7500000000000000  0.5024979336088011  0.2272513681634288
  0.7500000000000000  0.5049407356501087  0.4292476162003755
  0.7500000000000000  0.5031801362213933  0.6291315952965201
  0.7500000000000000 -0.0030509607301574  0.3292582852059248
  0.7500000000000000 -0.0049980965451264  0.5293359250978028
  0.7500000000000000 -0.0045763118696875  0.7293614825845562
  0.2500000000000000  0.0045763318696893  0.2706385174154441
  0.2500000000000000  0.0049981165451280  0.4706640749021971
  0.2500000000000000  0.0030509807301589  0.6707417447940780
!
mpirun $EXEC >> log.txt

E=`awk '/in/ && /kB/ {print $0}' OUTCAR`
echo 'delta=' $i >> result.txt

while IFS= read -r line; do
  if [[ $line =~ 'in' && $line =~ 'kB' ]]; then
     E=`echo $line`
  fi
done < OUTCAR

echo $E >> result.txt


done